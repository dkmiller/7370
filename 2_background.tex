% !TEX root = 7370.tex

\section{Background}

We'll thread a very narrow path to the main theorems, assuming a bunch of 
facts along the way. A good source on the algebraic geometry we'll do is
\cite[ch.2,3]{silverman-2009}. 





\subsection{Riemann-Roch}

We'll spend the rest of this subsection explaining the terms in the following 
theorem. 

\begin{theorem}[Riemann-Roch]
Let $C_{/k}$ be a smooth projective curve. Let $K$ be the canonical divisor and 
$D$ a divisor. Then $l(D)-l(K-D)=\deg D-g+1$. 
\end{theorem}

For us, a curve $C_{/k}$ is the zero locus of a (non-constant) polynomial 
$f\in k[x,y]$. We stress the fact that $k$ is \emph{not} necessarily 
algebraically closed here. Pictorially, smoothness means that $C$ has no 
cusps or self-intersections. For example, $f$ can't be something like 
$x y$ or $x^2-y^3$. More formally, we want the tangent space to be 
$1$-dimensional at every point on $C$. For any $c\in C$, we have a 
matrix 
$\begin{pmatrix} \frac{\partial f}{\partial x}(c),\frac{\partial f}{\partial y}(c)\end{pmatrix}$
which needs to be nondegenerate, i.e.~the partials of $f$ never 
simultaneously vanish. Note that here, ``$c\in C$'' means $c\in C(\bar k)$, so 
we consider points not defined over $k$. We'll constantly move between the 
affine curve $V(f)\subset \dA^2$ and the projective curve in $\dP^2$ cut out by 
the projectivisation of $f$. 

A \emph{divisor} on a curve $C$ is a formal $\dZ$-linear combination of points 
(defined over $\bar k$). 

\begin{example}
Let $C:x^2+y^2=10$. Let $P=(4,i\sqrt 6)$ and $Q=(4,-i\sqrt 6)$. Then $P$ and 
$Q$ are not defined over $\dQ$, but $P+Q$ is a divisor on $C$ defined over 
$\dQ$. 
\end{example}

The absolute Galois group $G_k$ of $k$ acts on the space of divisors on $C$. We 
say a divisor $D$ is \emph{defined over $k$} if $D=D^\sigma$ for all 
$\sigma\in G_k$. 

We put an equivalence relation on divisors: $D_1\sim D_2$ if 
$D_1-D_2=\divisor(f)$ for some rational function $f$ on $C$. 
So we need to define $\divisor(f)$. Let $k[C]=k[x,y]/f$ be the ring of regular 
functions on $f$, and let $k(C)$ be the field of fractions of $k[C]$; we call 
$k(C)$ the field of \emph{rational functions} on $C$. Any rational function 
$f$ induces a morphism $f:C\to \dP^1$. Since $C$ is projective, this map is 
either constant or surjective. We can now put 
\[
  \divisor(f) = \sum_{c\in C(\bar k)} \order_c(f) \cdot c.
\]
We put $\picard(C)=\divisors(C)/\divisor(k(C)^\times)$. 

Now we need to define the canonical divisor. It is the class of a nonvanishing 
differential on $C$. More formally, it's the divisor class corresponding to the 
line bundle $\Omega_C^1$. 

We put $l(D)=\dim \sL(D)$, where 
\[
  \sL(D) = \{f:C\epic \dP^1:\divisors(f)+D\geqslant 0\} \cup \{0\}.
\]
It is a theorem that $l(D) < \infty$ for all divisors $D$. 

Aside: let $[L:\dQ]<\infty$, i.e.~let $L$ be a number field. Then there is an 
exact sequence 
\[\begin{tikzcd}
  0 \ar[r] 
    & \cO_L^\times \ar[r] 
    & L^\times \ar[r] 
    & I_L \ar[r] 
    & \picard(O_L) \ar[r] 
    & 0 ,
\end{tikzcd}\]
where $I_L$ is the group of fractional ideals in $L$. See 
\cite{lorenzini-1996} for more on the parallel between 
algebraic number theory and algebraic geometry. This is analogous to the 
sequence 
\[\begin{tikzcd}
  0 \ar[r] 
    & k^\times \ar[r] 
    & k(C)^\times \ar[r, "\divisor"] 
    & \divisors^\circ(C) \ar[r] 
    & \picard^\circ(C) \ar[r] 
    & 0 .
\end{tikzcd}\]
Here the degree $\deg(\sum n_c c) = \sum n_c$. It is a basic fact that for 
$f\in k(C)^\times$, we have $\deg(f)=0$. In fact, $\picard(X)$ makes sense 
for $X$ any scheme (e.g.~a curve or the spectrum of $\cO_L$). 

If $C_{/\dQ}$ is a smooth projective curve, then $C(\dC)$ will be a compact 
Riemann surface, hence a torus with $g$ holes. We call $g$ the \emph{genus} of 
$C$. Geometrically, $g=\dim \h^0(\Omega^1)$. 

\begin{theorem}\label{thm:basic-facts}
Let $C_{/k}$ be a smooth projective curve, $D$ a divisor on $C$. Then 
\begin{enumerate}
\item $\deg D<0\Rightarrow l(D)=0$. 
\item $l(D)<\infty$. 
\item $D\sim D'\Rightarrow \sL(D)\simeq \sL(D')$. 
\item $l(K_C)=g$ and $\deg(K_C)=2 g-2$. 
\item $\deg(D)>2 g-2\Rightarrow l(D)=\deg(D)-g+1$. 
\end{enumerate}
\end{theorem}
\begin{proof}Choose $D$ cleverly (i.e.~$0$ or $K_C$) in the Riemann-Roch 
Theorem, and use $l(0)=1$. 
\end{proof}





\subsection{Elliptic curves}

If we're analyzing the case $g=0$, diophantine properties were known to the 
Greeks. For $g\geqslant 2$, Faltings tells that $\#C(\dQ)<\infty$. The 
remaining case is $g=1$. 

\begin{definition}
Let $k$ be a field. An \emph{elliptic curve over $k$} is a smooth projective 
curve $E_{/k}$ together with a point $0\in E(k)$. 
\end{definition}

Let $E_{/k}$ be an elliptic curve, $e\in E(k)$. What is $l(e)$? From 
\autoref{thm:basic-facts}, we get: 
\begin{center}
\begin{tabular}{c|cl}
$n$ & $l(n\cdot e)$ & basic of $\sL(n\cdot e)$ \\ \hline
1 & 1 & $\{1\}$ \\
2 & 2 & $\{1,x\}$ \\
3 & 3 & $\{1,x,y\}$ \\
4 & 4 & $\{1,x,y,x^2\}$ \\
5 & 5 & $\{1,x,t,x^2,x y\}$ \\
6 & 6 & $\{1,x,y,x^2,x y, x^3\text{ or } y^2\}$ 
\end{tabular}
\end{center}
The last set could have seven elements, but $\sL(6\cdot e)$ is 
$6$-dimensional. It follows that there is a dependence relation 
\[
  \alpha_0 + \alpha_1 x + \alpha_2 y+ \alpha_3 x^2 + \alpha_4 x y+\alpha_5 x^3 + \alpha_6 y^2 = 0 .
\]
We claim that $(\alpha_4,\alpha_6)\ne (0,0)$. Basic consideration of the 
orders of poles in the remaining equation at $e$ shows this. We can assume that 
$\alpha_6\ne 0$. Say $\alpha_6=0$ (then $\alpha_4\ne 0$). Consider the change 
of variables 
\begin{align*}
  x &\mapsto x + cy \\
  y &\mapsto y. 
\end{align*}
The new coefficient of $y^2$ is $\alpha_3 c^2 + \alpha_4 c$, and we can choose 
$c$ so that this is $\ne 0$. There's a better proof that $\alpha_6\ne 0$. If 
$\alpha_6=0$, since $\{1,x,y,x^2,x y,x^3\}$ is a basis of $\sL(6\cdot e)$, all 
the $\alpha_i=0$, which we can assume is not the case. 

Divide through by $\alpha_6$ to get the following:
\[
  y^2 + y (\alpha_2+\alpha_4 x) + \left(\frac{\alpha_2+\alpha_4 x}{2}\right)^2 - \left(\frac{\alpha_2+\alpha_4 x}{2}\right)^2 + \alpha_3 x^3 + \alpha_1 x + \alpha_0 = 0 .
\]
Replace $y$ by $y+\frac{\alpha_2+\alpha_4 x}{2}$; we get: 
\[
  y^2 = \gamma_3 x^3 + \gamma_2 x^2 + \gamma_1 x + \gamma_2 .
\]
Replace $y$ by $\gamma_3^2 y$ and $x$ by $\gamma_3 x$; this gives 
$x^3$ and $y^2$ the same coefficient. Rescale and we get 
\[
  y^2 = x^3 + \delta_2 x^2 + \delta_1 x + \delta_0 .
\]
Replace $x$ by $x-\frac{\delta_2}{3}$, and we get an equation 
\[
  y^2 = x^3 + A x+B 
\]
with $A,B\in k$. 

Note we have used that $k$ has characteristic not $2$ or 
$3$. Completion of squares doesn't work in characteristic $2$, and the 
first step in solving cubics doesn't work in characteristic $3$. So in 
characteristic $3$, you can get $y^2=(\text{cubic})$, but for characteristic 
$2$, you can't really simplify the equation at all. In general, if $A$ is a 
$d$-dimensional abelian variety, it is noted in \cite{serre-tate-1968} that 
primes $p\leqslant 2 d+1$ can be especially nasty. 

We will need to reduce elliptic curves modulo $2$ and $3$. 
Given $E_{/\dQ}$, there is an integer $N$, called the \emph{conductor} of $E$, 
that measures the ``badness'' of the singularities in the reductions of $E$. 
For $p\geqslant 3$, we have $v_p(N)\leqslant 2$. For 
$p=3$, we just have $v_3(N)\leqslant 4$, and for $p=2$, we can have 
$v_2(N)=6$. 

We'll continue under the assumption that $k=\dQ$. Write our curve 
$E_{/\dQ}$ as 
\[
  y^2=x^3 + \frac{N_1}{D} x + \frac{N_2}{D} ,
\]
with $N_1,N_2,D\in \dZ$. Make the change of variables 
\begin{align*}
  x &\mapsto x/D^2 \\ 
  y &\mapsto y/D^3 .
\end{align*}
Then multiply through by $D^6$ and relabel. We get 
\[
  y^2=x^3+ A x+ B x ,
\]
with $A,B\in \dZ$. For any prime $p$, say 
$p^4\mid A$ and $p^6\mid B$. Make the change of variables
\begin{align*}
  x &\mapsto p^2 x \\ 
  y &\mapsto p^3 y .
\end{align*}
you can rescale again until one of these possibilities fail. We end up with 
a Weierstrass form $y^2=x^3+A x+B$ with $p^4\mid A\Rightarrow p^6\nmid B$. This 
is the \emph{minimal model} of $E$. 

Now we can study $E_{/\dQ}$ and write $E=E_{A,B}$, given by $y^2=x^3+A x+B$, 
for $A,B\in \dZ$ with $(p^4\nmid A\text{ or }p^6\nmid B)$. Recall that 
$E_{A,B}$ is singular exactly if 
\[
  \begin{pmatrix} 2 y & 3 x^2+A\end{pmatrix} = 0
\]
for some $(x,y)\in E(\overline\dQ)$. This can happen only if 
$27 B^2+4 A^3=0$. The set of such $(A,B)$ is thin. 

This procedure works over $\dZ[\frac 1 6]\subset \dZ$. 





\subsection{Group law on an elliptic curve}

Let $E_{/k}$ be an elliptic curve in strong Weierstrass form 
$y^2=x^3+A x+B$. We will give $E$ the structure of an abelian 
variety over $k$. We declare $P+Q+R=0$ if $P$, $Q$, and $R$ lie on the same 
line through $E$ in $\dP^2$. This determines a morphism 
$E\times E\to E$ defined over $k$. From the definition, it is clear that 
addition is commutative. We won't verify that the group law is associative. 
It can be directly, but this is very tedious. A more conceptual approach is to 
use the Picard variety. To summarize: 

\begin{theorem}
Let $E_{/k}$ be an elliptic curve given by $y^2=x^3+A x+B$. Then $E$ has the 
unique structure of an abelian variety such that $(0:1:0)$ is the identity 
element. 
\end{theorem}
\begin{proof}
Existence follows from the fact that the map $E\to \picard^0(E)$ is an 
isomorphism of varieties over $k$. Uniqueness follows from Proposition 1.13 of 
\cite{moonenABV}. 
\end{proof}

Let $P=(\alpha,\beta)$. What is $2 P=P+P$? We can implicitly differentiate 
$y^2=x^3+A x+B$ to get 
\[
  y' = \left.\frac{3 x^2+A}{2 y}\right|_{(\alpha,\beta)} = \frac{3\alpha^2+A}{2 \beta} .
\]
We can solve the equation 
\[
  \left(\beta+\frac{3\alpha^2+A}{2\beta}(x-\alpha)\right)^2 = x^3+A x+B ,
\]
to see that the third root is $\frac{(3\alpha^2+A)^2}{4\beta^2} - 2\alpha$. So 
\[
  x_{2 P} = \frac{(3\alpha^2+A)^2}{4(\alpha^3+A\alpha+B)} - 2\alpha ,
\]
and $y_{2 P}$ can be computed similarly. 

Given $Q=(\alpha,\beta)\in E(\overline K)$, let's find $P$ such that 
$2 P=Q$. Since $\# E[2](\overline K)=4$, we expect four such $P$. It comes down 
to solving the equation 
\[
  \frac{(3\alpha^2+A)^2}{4(\alpha^3+A\alpha+B)} - 2\alpha = r .
\]
The polynomial on the left has degree $4$, so there will indeed be four $P$. 

In general, given $Q\in E(\overline K)$, the equation $n P=Q$ has $n^2$ 
solutions, provided $n$ is invertible in $k$. Also, if $n$ is invertible in 
$k$, then $E[n]\simeq (\dZ/n)^2$, and $G_K=\galois(\overline K/K)$ acts on 
$E[n]$ by group automorphisms. This is really easy. To verify this, all we need 
to check is that $\sigma(P+Q)=\sigma(P)+\sigma(Q)$ for all $\sigma\in G_K$ and 
$P,Q\in E(\overline K)$. But $x_{P+Q}$ and $y_{P+Q}$ are rational functions in 
the coordinates of $P$ and $Q$, \emph{defined over $K$}. If 
$f\in K(t)$ is a rational function, then $\sigma(f(x))=f(\sigma(x))$ for all 
$x\in \overline K$, whence $\sigma(x_{P+Q})=x_{\sigma P+\sigma Q}$. 

Given $E_{/\dQ}$, set $a_p=p+1-\# E(\dF_p)$, where $E(\dF_p)$ is the 
$\dF_p$-points of the projective curve associated to $E$. Note that 
$p+1=\dP^1(\dF_p)$. Note that this only makes sense for $p\nmid \Delta$. 

\begin{theorem}[Hasse]
$|a_p|\leqslant 2\sqrt p$. 
\end{theorem}
Recall the $L$-function of $E$ is defined in terms of the $a_p$: 
\[
  L(E,p) = \text{(finite \# of terms)} \prod_{p\nmid \Delta} \left(1-\frac{a_p}{p^s} + \frac{p}{p^{2s}}\right)^{-1} .
\]
If $\Re s=\frac 3 2+\epsilon$, then 
\[
  \left|-\frac{a_p}{p^s} + \frac{p}{p^{2s}}\right| \leqslant \frac{2}{p^{1+\epsilon}}+\frac{1}{p^{2+2\epsilon}} \leqslant p^{-1-\epsilon/2} ,
\]
at least for $p\gg 0$. We know that $\prod (1-p^{-s})^{-1}$ converges for 
$\Re s>1$. Thus $L(E,s)$ is defined for $\Re s>3/2$. 

We know that $|a_p|\leqslant p+1$. This gives well-definedness of $L(E,s)$ for 
$\Re s>2$, and it isn't too hard to get $\Re s>3/2$. The following theorem was 
proved in the course of Wiles' proof of Fermat's Last Theorem. 

\begin{theorem}
$L(E,s)$ has a meromorphic continuation to $\dC$. 
\end{theorem}

Recall the weak Birch and Swinnerton-Dyer conjecture:

\begin{conjecture}
$\order_{s=1} L(E,s) = \rank E$. 
\end{conjecture}
Note that $\rank E$ is global data, while the $a_p$ only depend on the reduction 
$E_{/\dF_p}$. The following theorem was known as the Sato-Tate conjecture. 

\begin{theorem}[Taylor et.~al.]
Define $\theta_p$ by $\frac{a_p}{2\sqrt p} = \cos(\theta_p)$ and 
$\theta_p\in [-\pi/2,\pi/2)$. Then 
\[
  \lim_{X\to \infty}\frac{\#\{p\leqslant X:c\leqslant \theta_p\leqslant d\}}{\pi(X)} = \frac 2 \pi \int_c^d \sin^2(u)\, \mathrm{d} u .
\]
\end{theorem}
\begin{proof}
In \cite{serre-1968}, Serre outlined a strategy. It relied on 
$L(\symmetric^n E,s)$ being analytic at $1$ for infinitely many $n$. At the 
time, we didn't even know this for $n=1$! This requires a vast generalization 
of Wiles et.~al.~(who worked with $n=1$). 
\end{proof}

In some ways, the Sato-Tate conjecture is unsatisfying because it says that 
``all (non-CM) elliptic curves are the same.'' On the other hand, the Birch and 
Swinnerton-Dyer conjecture is about how local data of elliptic curves gives 
information about global data. 

\begin{conjecture}[Harris]
Let $E_1$, $E_2$ be non-isogenous (up to twist) elliptic curves over $\dQ$. 
Then the Sato-Tate distributions of $E_1$, $E_2$ are independent. 
\end{conjecture}

See \cite{harris-ST} for a careful statement and motivation. 
There is an obvious family to pairwise non-isogenous families 
$\{E_1,\cdots,E_n\}$, but there isn't a clear approach to prove this. 





\subsection{Kummer theory}

Let $K\subset L$ be a Galois field extension. There is a version of Galois 
theory for $G=\galois(L/K)$, but we need to give $G$ a topology. Let a basis 
of $1$ be the subgroups of the form $G_x=\stabilizer_G(x)$ for $x\in L$. Under 
this topology (the \emph{Krull topology}), the group $G$ is compact, Hausdorff, 
and totally disconnected. See Chapter IV of \cite{neukirch-1999} for details. 

Let $k$ be a field, $p$ a prime invertible in $k$ such that $\dmu_p\subset k$. 
Let $k^{(p)}$ be the composite of all $\dZ/p$-Galois extensions of $k$ in 
$\overline k$. 

\begin{theorem}
The pairing $\galois(k^{(p)}/k)\times k^\times/p \to \dmu_p$ given by 
\[
  \langle \sigma,x\rangle = \frac{\sigma(x^{1/p})}{x^{1/p}} 
\]
is a well-defined perfect pairing of topological groups. 
\end{theorem}
\begin{proof}
Say $\langle \sigma,x_0\rangle=1$ for all $\sigma\in \galois(k^{(p)}/k)$. Then 
$\sigma(x_0^{1/p})=x_0^{1/p}$ for all $\sigma$. This implies 
$x_0^{1/p}$ is fixed by $\galois(k^{(p)}/k)$, which implies 
$x_0^{1/p}\in k$, which implies $x_0\in (k^\times)^p$. 

Now suppose $\langle \sigma_0,x\rangle = 1$ for all $x\in k^\times$. So 
$\sigma_0(x^{1/p})=x^{1/p}$ for all $x\in k^\times$. In particular, $\sigma_0$ 
is trivial on $k(x^{1/p}:x\in k^\times)$. We want for this field to be 
$k^{(p)}$. It suffices to check that if $K/k$ is a $\dZ/p$-extension, then 
$K=k(x^{1/p})$ for some $x\in k$. Recall Hilbert's Theorem 90: an element 
$x\in K^\times$ satisfies $\norm_{K/k}(x)=1$ if and only if there exists $y$ 
such that $x=y/\tau(y)$, where $\tau$ is any generator of $\galois(K/k)$. Since 
$\norm_{K/k}(\zeta_p)=\zeta_p^p1$, we get $\zeta_p=y/\tau(y)$, so 
$\tau(y)=\zeta_p^{-1} y$. Since $y\in K\smallsetminus k$, we know that 
$K=k(y)$. But $\tau(y)=\zeta_p^{-1} y$ tells us that $y^p\in k$, so $K$ is 
generated by a $p$-th root of an element of $k$. 
\end{proof}

See \cite[IV \S 3]{neukirch-1999} for a proof. The theorem, correctly 
rephrased, works with arbitrary $n$ invertible in $k$. Hilbert's Theorem 90 is 
a very special case of the extremely general result that 
$\h^1(X_\etale,\Gm) = \picard(X)$ for any noetherian scheme $X$ 
\cite[I 2.2.3]{sga4-5}. 

As an example, for $p=2$ and $k=\dR$, we see that there is only one 
$\dZ/2$-extension of $\dR$. This can be used to show that $\dC$ has no solvable 
extensions. 

There is a purely geometric approach to Kummer theory. Let $X$ be a scheme 
on which $n$ is invertible. The \emph{Kummer exact sequence} is the sequence 
\[
  1 \to \dmu_n \to \Gm \xrightarrow n \Gm \to 1 
\]
of \'etale sheaves on $X$. The long exact sequence in sheaf cohomology gives 
us a short exact sequence: 
\[
  1 \to \sO(X)^\times/n \to \h^1(X,\dmu_n) \to \picard(X)[n] \to 1 .
\]
Since $\dmu_n\simeq \dZ/n$, we have $\h^1(X,\dmu_n)=\hom(\pi_1(X),\dZ/n)$. 
When $X=\spectrum(k)$, we have $\picard(X)=0$, so 
$k^\times/n\simeq \hom(G_k,\dZ/n)$. For arbitrary $X$, the Kummer exact 
sequence can be used to get a pretty good grasp of $\pi_1(X)^\mathrm{ab}$. 
See \cite[5.8.3]{szamuely-2009} for details. 

Kummer theory is used to study solvable extensions in classical algebraic 
number theory. More generally, it is used in class field theory to build the 
abelian extensions of a field. Finally, it is used in local and global duality 
theorems in the cohomology of $G_\dQ$, $G_{\dQ_l}$. 

The Weil pairing is a kind of ``geometric Kummer theory.'' It is a perfect 
pairing $E[m]\times E[m]\to \dmu_m$. This means that 
$E[m]\simeq \hom(E[m],\dmu_m)=E[m]^\vee$, the dual in the correct sense. So 
$E[m]$ is self-dual in some sense. Even better, 
$E[m]^\vee\simeq \h^1_\mathrm{et}(E,\dZ/m)$, and the Weil pairing is comes from 
the cup-product 
pairing in \'etale cohomology: 
\[
  \h^1(E,\dZ/m)\times \h^1(E,\dZ/m) \to \h^2(E,\dZ/m).
\]

\begin{example}
Let $p=2$ and $k=\dQ$. Then 
$\dQ^{(2)}=\dQ(\sqrt{-1},\sqrt{l}\text{ all prime }l)$. Note that 
\[
  \galois(\dQ^{(2)}/\dQ) \simeq \prod_{l,-1} \dZ/2 .
\]
On the other hand, $\dQ^\times/2 = \bigoplus_{l,-1} \dZ/2$. The point is that 
the Kummer pairing is between a discrete group and a (uncountable) compact 
group. 
\end{example}

In general, Galois groups are either finite or uncountable (because they're 
compact). There is one case in which we can explicitly describe the entire 
absolute Galois group of a field. 

\begin{theorem}
Let $\dF_q$ be the finite field of cardinality $q$. For each $n\geqslant 1$, 
there is a unique degree $n$ extension $\dF_{q^n}/\dF_q$. This extension satisfies 
$\galois(\dF_{q^n}/\dF_q)$. 
\end{theorem}
\begin{proof}
Find such $\dF_{q^n}$ in $\overline{\dF_q}$. It has cardinality $q^n$, and 
$\dF_{q^n}^\times\simeq \dZ/(q^n-1)$. Indeed, if it wasn't cyclic, then 
$x^{q^n}-1$ has too many roots in $\dF_{q^n}$. The splitting field of 
$x^{q^n}-x$ gives a degree $n$ extension of $\dF_q$, and this must be unique 
because any other degree-$n$ extension of $\dF_q$ must contain all 
$(q^n-1)$-th roots of unity. 
\end{proof}





\subsection{Weil pairing}

We start with some needed facts, which are proved using Riemann-Roch. Let 
$k$ be a field, $n\geqslant 2$ an integer invertible in $k$, and let 
$E_{/k}$ be an elliptic curve. Suppose $D=\sum n_x(x)$ is a divisor on $E$. 
\begin{enumerate}
\item
If $\deg(D)=0$, then $D=\divisor(f)$ for some rational function $f$ on $E$ if 
and only if $\sum [n_x] x=0$ as an element of $E(\overline k)$. 

\item
If $x\ne 0$ in $E$, then $(x)-(0)\ne \divisor(f)$ in $\picard^\circ(E)$. 
\end{enumerate}

Given $x,y\in E[n]$, we'll define $e_n(x,y)\in \dmu_n$ following 
\cite[III \S 8]{silverman-2009}. By fact 1 above, the divisor 
$D=n(y)-n(0)$ is $\divisor(f)$ for some function $f$ on $E$. Let $y'$ be such 
that $[n]y'=y$, and consider 
\[
  [n]^\ast D = \sum_{z\in E[n]} (y'+z)-(z) ,
\]
where $y'+z$ is defined using the addition in $E$. This is a degree-$0$ 
diivisor, and within $E$, we have $\sum_{z\in E[n]}(y'+z-z)=n^2 y' = n y = 0$. 
Thus $[n]^\ast D=\divisor(g)$ for some $g$, and it is easy to check that we 
must have $f = c g^n$ for some $c\in \overline k$. We can replace $g$ by a 
scalar multiple to get $f=g^n$. Note that 
$g(t+x)^n = f([n] t+[n] x) = f([n] t) = g(t)^n$. Thus we can define 
\[
  e_n(x,y) = \frac{g(t+x)}{g(t)}
\]
for any $t$ in the domain of $g$. Note that this definition is 
asymmetric with respect to $x,y$. Also $f,g$ are independent of $y$. 

\begin{theorem}
Let $E_{/k}$ be an elliptic curve. Then: 
\begin{enumerate}
  \item $e_n(x_1+x_2,y) = e_n(x_1,y) e_n(x_2,y)$ 
  \item $e_n(x,y_1+y_2) = e_n(x,y_1) e_n(x,y_2)$ 
  \item $e_n(x,x)=1$, so $e_n(x,y) = e_n(y,x)^{-1}$ 
  \item $e_n(x,y)^\sigma = e_n(x^\sigma,y^\sigma)$ for all $\sigma\in G_k$. 
  \item $e_n(x,y)=1$ for all $x$ implies $y=0$, and vice versa. 
\end{enumerate}
\end{theorem}
\begin{proof}
This is Proposition III.8.1 in \cite{silverman-2009}. 

1. We have 
\begin{align*}
  e_n(x_1+x_2,y) 
    &= \frac{g(t+x_1+x_2)}{g(t)} \\
    &= \frac{g((t+x_1)+x_2)}{g(t+x_1)} \frac{g(t+x_1)}{g(t)} \\
    &= e_n(x_1,y) e_n(x_2,y) .
\end{align*}
The other part is more involved. Call $y_3=y_1+y_2$. Let 
$f_i,g_i$ be the functions for $y_i$. We must relate $g_3$ to $g_1,g_2$. 
Put $D=(y_3)-(y_1)-(y_2)+(0)$; this has degree $0$, and the sum of its points 
is $0$ in $E$, so $D=\divisor(h)$ for some $h$. Recall that 
$\divisor(f_i) = n(y_i) - n(0)$. Thus 
\[
  \divisor\left(\frac{f_3}{f_1 f_2}\right) = \divisor(h^n) .
\]
Thus $f_3=c f_1 f_2 h^n$ for some $c$. It follows that 
$f_3\circ [n] = c f_1\circ [n] f_2\circ [n] (h\circ [n])^n$, so 
$g_3^n = g_1^n g_2^n (h\circ [n])^n$. Take $n$-th roots: we get 
$g_3 = \widetilde c g_1 g_2 (h\circ [n])$. We can now compute: 
\begin{align*}
  e_n(x,t_3) 
    &= \frac{g_3(t+x)}{g_3(t)} \\
    &= \frac{g_1(t+x)g_2(t+x)h([n] t+[n] x)}{g_1(t) g_2(t) h([n] t)} \\
    &= e_n(x,y_1) e_n(x,y_2) .
\end{align*}

4. We compute 
\[
  e_n(x,y)^\sigma 
    = \left(\frac{g(t+x)}{g(t)}\right)^\sigma 
    = \frac{g^\sigma(t^\sigma+x^\sigma)}{g^\sigma(t^\sigma)} 
    = e_n(x^\sigma,y^\sigma) .
\]

We leave the rest of the proof as an exercise. 
\end{proof}

The alternating property and Galois-equivariance of the Kummer pairing have a 
nice consequence. Choose a generating set $x,y\in E[n]$, $\sigma\in G_k$. Then 
$\sigma$ acts on $E[n]$ via some matrix 
$\begin{pmatrix} a & b \\ c & d \end{pmatrix}\in \GL_2(\dZ/n)$ 
with respect to the basis $\{x,y\}$. Suppose $e_n(x,y)=\zeta\in \dmu_n$. Then 
$\sigma(\zeta) = \zeta^{\chi(\sigma)}$, where $\chi:G_k\to \GL_1(\dZ/n)$ is 
the cyclotomic character. Write $\rho_{E,n}:G_k\to \GL_2(\dZ/n)$ for the 
representation coming from $E$. We claim that $\det\rho_{E,n} = \chi_n$. All 
we need to show is that $e_n(x,y)^\sigma = \zeta^\sigma = \zeta^{a d-b c}$. We 
know that $e_n(x,y)^\sigma = e_n(x^\sigma,y^\sigma) = e_n(a x+c y, b x+d t)$; 
we're left with $e_n(x,y)^{a b-c d}$, as desired. 

The Weil pairing makes $E[n]$ self-dual as a representation of $G_k$. 
Let $X_{/k}$ be a smooth projective curve. There is a canonical pairing 
(``cup-product''): 
\[
  \h_\etale^1(X,\dmu_n)\times \h_\etale^1(X,\dmu_n) \to \h_\etale^2(X,\dmu_n) = \dmu_n .
\]
Moreover, $\h_\etale^1(X,\dmu_n) \simeq \jacobian(X)[n]$, where $\jacobian(X)$ 
is the \emph{Jacobian} of $X$, a $g$-dimensional abelian variety containing 
$X$. Thus $\jacobian(X)$ has a group structure, while $X$ does not. 

The algebraic analogue of the notion of a local diffeomorphism is a 
\emph{finite \'etale cover}. It turns out that $\jacobian(X)[n]$ parameterizes 
degree-$n$ finite \'etale covers of $X$ with abelian Galois group. There is a 
``Weil pairing'' on $\jacobian(X)$ coming from the Poincar\'e bundle, but it 
agrees with the cup-product. 

There is an analogy between Kummer theory and the Weil pairing. Recall that if 
$k$ is a field of characteristic not $p$ which contains all $p$-th roots of 
unity, and if $k^{(p)}$ is the maximal abelian $p$-extension of $k$, then the 
obvious pairing $\galois(k^{(p)}/k)\times k^\times/p \to \dmu_p$ is perfect. 





\subsection{Isogenies}

An \emph{isogeny} will be morphisms between elliptic curves, defined over the 
base field. Since elliptic curves are varieties, we should require these 
morphisms to be polynomial (or rational). Since elliptic curves have a group 
law, we also want these morphisms to respect this structure. Summing up: if we 
think of elliptic curves as group objects in the category of projective 
varieties (projective $\Rightarrow$ abelian), an isogeny is a non-constant 
morphism of such objects. More formally, 

\begin{definition}
Let $E_1,E_2$ be elliptic curves over $k$, $\phi:E_1\to E_2$ a morphism. We say 
$\phi$ is an \emph{isogeny} if it is a dominant morphism of varieties, and 
satisfies $\phi(0)=0$. 
\end{definition}

It turns out that if $\phi$ is an isogeny, then $\phi$ is actually a morphism 
of group schemes. 
If $\phi:E_1\to E_2$ is defined over $k$, then $\ker\phi$ is $G_k$-stable as a 
group (not pointwise). Given $E_{/\dQ}$ and an isogeny $\phi:E\to E$, usually 
$\phi$ is $[n]$ for some $n\in\dZ\smallsetminus 0$. 
When there are isogenies not of this form, amazing congruences happen. 

\begin{example}
Let $\Delta=q \prod_{n\geqslant 1} (q-1^n)^{24} = \sum \tau(n) q^n$; the first 
few terms are: 
\[
  \Delta = q-24 q^2 + 252 q^3 - 1472 q^4 + 4830 q^5 - 6048 q^6 + \cdots .
\]
Ramanujan observed that $(m,n)=1$ implies $\tau(m n) = \tau(m) \tau(n)$. He 
also observed that for a prime $p$, 
$\tau(p^{r+1}) = \tau(p) \tau(p^r) - p^{11} \tau(p^{r-1})$. Also, 
$|\tau(p)|\leqslant 2 p^{11/2}$ (this is hard: it was proved by Deligne in the 
course of the Weil conjectures). Finally, 
\[
  \tau(n) \equiv \sigma_{11}(n) = \sum_{d\mid n} d^{11} \pmod{691} .
\]
This congruence is a manifestation of the ``existence of a non-trivial 
isogeny.'' 
\end{example}

This example is one of the first cases of a congruence between a \emph{cusp 
form} and \emph{Eisenstein series}. The first paper to make much use of this 
idea is \cite{ribet-1976}, in which Ribet used modular forms to prove the 
converse of Kummer's criterion. The ideas here were crucial in the proof of 
Iwasawa's Main Conjecture, Skinner and Urban's recent work, and many other 
parts of modern number theory. See Mazur's survey article 
\cite{mazur-2011} for an excellent overview of this circle of ideas. 

If $V_{/k}$ is an irreducible variety, it has a function field $k(V)$. If 
$\phi:V\to W$ is a morphism of varieties, there is a inclusion 
$\phi^\ast:k(W)\to k(V)$, assuming $\phi$ is surjective. So the Frobenius 
$\dP_{/\dF_p}^1\to \dP_{/\dF_p}^1$ sending $(x_0:x_1)$ to 
$(x_0^p:x_1^p)$ induces a map 
$\dF_p(t)\to \dF_p(t)$, $f(t)\mapsto f(t^p)$. The field extension 
$\dF_p(t^{1/p})/\dF_p(t)$ is purely inseparable, and has degree $p$. In 
characteristic $p$, the geometric Frobenius $\Frob:E\to E$ an isogeny, but 
\emph{not} an isomorphism of varieties, as ``the inverse'' involves taking 
$p$-th roots. It turns out that $\Frob$ has degree $p$, and is purely 
inseparable. 

In characteristic zero, $\deg(\phi)$ is $\# \phi^{-1}(x)$ for ``generic'' 
$x$, and $[k(E_1):\phi^\ast k(E_2)]$ in characteristic $p$. One has to check 
that these two quantities agree in characteristic zero. If $V_{/\dF_q}$ is a 
$d$-dimensional variety, then $\Frob_q:V\to V$ has degree $q^d$. 

Let $E_{/\dQ}$ be an elliptic curve. Consider an isogeny 
$\phi:E\to \widetilde E$ of degree $p$ defined over $\dQ$. Since 
$\#\ker(\phi)=p$, we have $\ker(\phi)\subset E[p]$. Moreover, $\ker(\phi)$ is 
stable under the action of $G_\dQ$. Note that $\widetilde E=E/\ker\phi$. So we 
have a pair $(E,C)$, where $E_{/\dQ}$ is an elliptic curve, and $C\subset E$ is 
a subgroup of order $p$ defined over $\dQ$. Alternatively, we could study pairs 
$(E,P)$, where $E_{/\dQ}$ is an elliptic curve and $P\in E[p](\dQ)$ has order 
$p$. Since $G_\dQ$ acts on $E[p]$, we have a representation 
$\rho:G_\dQ\to \GL_2(\dZ/p)$. In the first case, the image fits inside 
$\begin{pmatrix} \ast & \ast \\ & \ast \end{pmatrix}$, and in 
the second case it looks like 
$\begin{pmatrix} 1 & \ast \\ & \varepsilon\end{pmatrix}$, 
where $\varepsilon:G_\dQ\to \dF_p^\times$ must be the cyclotomic character, 
defined by $\sigma(\zeta_p) = \zeta_p^{\varepsilon(\sigma)}$. 

There are moduli spaces for pairs $(E,C)$ and $(E,P)$ as above, namely the 
modular curves $Y_0(p)_{/\dQ}$ and $Y_1(p)_{/\dQ}$. There is a natural 
isomorphism $Y_0(p)(\dC) = \fH/\Gamma_0(p)$, where 
\[
  \Gamma_0(p) = \left\{\begin{pmatrix} a & b \\ c & d \end{pmatrix}\in \SL_2(\dZ):c\equiv 0\pmod p\right\} .
\]
The curve $Y_0(p)$ is affine; let $X_0(p)$ be its compactification. The 
classification of pairs $(E,C)$ defined over $\dQ$ comes down to the study of 
$Y_0(p)(\dQ)$. The complex points of $Y_1(p)$ are in bijection with 
$\fH/\Gamma_1(p)$, where 
\[
  \Gamma_1(p) = \left\{\gamma\in \SL_2(\dZ):\gamma\equiv \begin{pmatrix} 1 & \ast \\ & 1 \end{pmatrix} \pmod p\right\} .
\]

\begin{theorem}[Mazur]
$Y_0(p)(\dQ)=\varnothing$ for all $p\geqslant 11$. 
\end{theorem}

This implies that there does not exist an $E_{/\dQ}$ and (for $p\geqslant 11$) 
$P\in E(\dQ)$ of order $p$. This theorem is proved in the seminal paper 
\cite{mazur-1977}. This allows the classification of $E(\dQ)_\mathrm{tors}$ for 
$E_{/\dQ}$. Mazur's theorem tells us that $p\nmid E(\dQ)_\mathrm{tors}$ for 
$p\geqslant 11$. All that remains are the primes $p<11$, and this is a finite 
list. 

Note that an isogeny can be given by a pair $(E,C)$, where $E_{/k}$ is an 
elliptic curve and $C_{/k}$ is a subgroup scheme of $E$. The quotient $E/C$ 
must be defined in the appropriate sense -- this can get pretty complicated. 

Are isogenies ramified? Let's restrict to characteristic zero. We are asking: 
if $\phi:E_1\to E_2$ is an isogeny, are there points $x\in E_2(\bar k)$ such 
that $\#\phi^{-1}(x)< \deg(\phi)$? The answer is no: isogenies are \'etale, 
hence unramified. This is because $\phi$ is a group homomorphism, so 
$\#\phi^{-1}(x) = \# \phi^{-1}(0) = \deg(\phi)$ for all $x$. If 
$\phi:C_1\to C_2$ is a map between curves over $k$, then if one of the curves 
isn't elliptic, it's possible for $\phi$ to have ramification points. The 
Riemann-Hurwitz formula gives us a bound on possible ramification. 





\subsection{Jacobians}

Let $C_{/k}$ be a curve. The \emph{Jacobian} of $C$, denoted $\jacobian(C)$, 
is a group variety build from $C$, which has a natural map $C\to \jacobian(C)$. 
If $C$ has genus $g$, then $\jacobian(C)$ is $g$-dimensional. 

The \emph{divisor group} of $C$, denoted $\divisors(C)$, is the free abelian 
group on $C(\bar k)$. It contains a subgroup $\divisors^\circ(C)$ consisting 
of degree-zero divisors. There is a smaller subgroup of \emph{principal 
divisors}, which are of the form $\divisor(f)$ for $f\in k(C)^\times$. One can 
show that $\deg(\divisor(f))=0$ for all such $f$. Define 
$\picard^\circ(C)$ to be the quotient 
$\divisors^\circ(C)/\divisor(k(C)^\times)$. 

\begin{theorem}
Let $C_{/k}$ be a genus-$g$ curve. Then $\picard^\circ(C)$ naturally has the 
structure of the $\bar k$-points of a $g$-dimensional abelian variety over $k$. 
\end{theorem}

Note that we've only constructed $\jacobian(C)$ as an abstract group. The 
underlying variety can be quite complicated. See \cite{kleiman-2005} for a 
survey of general Picard schemes. 

\begin{example}
Work over $\dC$. An elliptic curve $E_{/\dC}$ is just a complex torus. Let 
$L_1,L_2$ be generators for $\pi_1(E)$. Since $E$ has genus $1$, the space of 
holomorphic differential forms is one-dimensional, spanned by $\omega$. Let 
$A_i=\int_{L_i} \omega$. Then $\dC/\langle A_1,A_2\rangle\simeq E(\dC)$. 
\end{example}

If $C$ has genus $g\geqslant 2$, there are $2 g$ loops $L_1,\dots,L_{2 g}$ and 
$g$ holomorphic differentials $\omega_1,\dots,\omega_g$. One gets 
$\jacobian(C)(\dC) = \dC^g / \Lambda$, where $\Lambda$ is the lattice spanned 
by the vectors 
\[
  \int_{L_i} \begin{pmatrix} \omega_1 \\ \vdots \\ \omega_g \end{pmatrix}\qquad (1\leqslant i \leqslant 2 g ).
\]

Back to an elliptic curve $E_{/k}$. There is a map 
$\kappa:E\to \picard^\circ(E)$; this is an isomorphism. It sends 
$x\in E$ to the divisor $(x)-(0)$. If $\phi:E_1\to E_2$ is an isogeny, it 
induces a map $\phi^\ast:\picard^\circ(E_2)\to \picard^\circ(E_1)$ by 
pullback of divisors: $D\mapsto \phi^\ast D$, where 
\[
  \phi^\ast \sum n_x(x) = \sum n_x \phi^{-1}(x) .
\]
We can use our isomorphisms $E_i\iso \picard^\circ(E_i)$ to get an isogeny 
$\phi^\vee:E_2\to E_1$, given by 
$\phi^\vee = \kappa_1^{-1}\circ \phi^\ast\circ \kappa_2$. We call 
$\phi^\vee:E_2\to E_1$ the \emph{dual isogeny} to $\phi$. We have not (and will 
not) checked, but it is true, that: 
\begin{itemize}
  \item $\picard^\circ(C)$ is a smooth projective variety over $k$. 
  \item $\kappa$ is an isomorphism of varieties. 
  \item $\phi^\vee$ is an isogeny. 
\end{itemize}

It turns out that $\deg:\hom_k(E,E)\to \dN$ is a positive definite quadratic 
form. This depends on the fact that $\phi^\vee\circ\phi=[\deg\phi]$. The 
degree map is clearly positive-definite. To show that it's a quadratic form, 
just check that $\deg(\phi+\psi)-\deg(\phi)-\deg(\psi)$ is bilinear. We can 
compute: 
\begin{align*}
  (\phi+\psi)^\vee(\phi+\psi) - \phi^\vee \phi - \psi^\vee \psi 
    &= \phi^\vee\phi + \psi^\vee \phi + \phi^\vee \psi + \psi^\vee \psi - \phi^\vee \phi - \psi^\vee \psi \\
    &= \phi^\vee \psi - \psi^\vee  \phi ,
\end{align*}
which yields the desired result. 

In general, if $d:A\to \dZ$ is a positive definite quadratic form for 
some abelian group $A$, then 
$|d(\psi-\phi)-d(\psi)-d(\phi)|\leqslant 2\sqrt{d(\phi)d(\psi)}$. This is 
basically Cauchy-Schwarz. 

\begin{theorem}
Let $E_{/\dF_q}$ be an elliptic curve. Then $|\#E(\dF_q)-q-1|\leqslant 2\sqrt q$. 
\end{theorem}
\begin{proof}
Given $E_{/\dF_q}$, the map $\Frob_q-1$ is separable. Moreover, 
$\ker(\Frob_q-1) = E(\dF_q)$. Now we use Cauchy-Schwarz for the isogenies 
$\phi=\Frob$, $\psi=1$. We get 
\begin{align*}
  |\#E(\dF_q)-q-1| 
    &=|\deg(\Frob-1)-\deg(\Frob)-\deg(1)| \\
    &\leqslant 2\sqrt{\deg(\Frob)\deg(1)} \\
    &= 2\sqrt{1\cdot q} .
\end{align*}
\end{proof}

This is a real theorem. A Putnam exam had the following question: 
consider the equation $y^2=x^3+A x+B$ for $A,B\in \dZ$. Show that there exist 
solutions modulo $p$ for all $p$. Assume the induced (projective) curve $E$ 
is smooth. It is also true that $E_{/\dF_p}$ is smooth for all but finitely 
many $p$. For these good $p$, we know that 
$|\# E(\dF_p) - p - 1|\leqslant 2\sqrt p$. The curve $E$ has no affine 
solutions only when $\# E(\dF_p)=1$, which gets $1<2/\sqrt p$. This gives us 
the solution for all $p$ of good reduction. 

Note that as $q\to \infty$, we get $\# E(\dF_q) \sim q+1$, which clearly goes to 
infinity. So for $q$ large, \emph{all} $E_{/\dF_q}$ will have nonzero points. 
If $(6,q)=1$, then $E_{/\dF_q}$ is of the form $y^2=x^3+A x+B=f(x)$. Define a 
character $\chi:\dF_q\to \dZ$ by 
\[
  \chi(x) = \begin{cases} 1 & x\in (\dF_q^\times)^2 \\ -1 & x\notin (\dF_q^\times)^2 \\ 0 & x=0 \end{cases}.
\]
We have 
\[
  \# E(\dF_q) = 1 + \sum_{x\in \dF_q}\left(\chi(f(x))+1\right) = q+1 + \sum_{x\in \dF_q} \chi(f(x)) .
\]
So there is some finite Fourier analysis going on here -- this has a distant 
relation with the Langlands program. Recall that in characteristic $p$, if you 
want a degree $p$ separable extension, you don't study $x^p-\alpha$ -- rather, you 
study Artin-Schreier theory and study equations of the form $x^p-x-\alpha$. In 
general, we want \emph{separable} polynomials, where $g$ is separable if 
$(g,g')=1$. 

\begin{theorem}
No elliptic curve $E_{/\dQ}$ given by $y^2=x^3+A x+B$ with $A,B\in \dZ$ has 
good reduction at all primes, i.e.~is smooth modulo $p$ for all $p$. 
\end{theorem}
\begin{proof}
For $E$ to be smooth modulo $p$ for all $p$, we need $x^3+A x+B$ to have 
distinct roots modulo $p$ for all $p$. Let $\alpha,\beta,\gamma$ be the roots, 
and set $\Delta=\left((\alpha-\beta)(\beta-\gamma)(\gamma-\alpha)\right)^2$. 
You can check that $\Delta=\pm (4 A^3+27 B^2)$. If $\Delta\notin \{\pm 1\}$, 
then some prime $p\mid\Delta$, which means that $E_{/\dF_p}$ is singular. So 
we need $\Delta=\pm 1$, which gives $4 A^3\equiv \pm 1\pmod 9$. This means 
$x^3\in \{0,\pm 1\}\pmod 9$, and there is no way that 
$0,\pm 4$ can be congruent to $\pm 1$ modulo $9$. 
\end{proof}

It is known that there are finite extensions $L/\dQ$ and elliptic 
schemes $E_{/\cO_L}$. On the other hand, we have the following: 

\begin{theorem}[Fontaine]
There are no abelian varieties over $\dZ$. 
\end{theorem}
\begin{proof}
See Fontaine's beautiful paper \cite{fontaine-1985}. 
\end{proof}

% exercise: Consider the elliptic curve $y^2=x^3+3 x+1$. Find $\# E(\dF_{5^3})$. 

Let $k$ be a field of characteristic $p$ and $E_{/k}$ be an elliptic curve 
$y^2=x^3+a x+b$. Then $\Frob_q$ is \emph{not} a morphism $E\to E$. Rather, it 
is a morphism $E\to E^{(q)}$, where $E^{(q)}$ has Weierstrass equation 
$y^2=x^2+a^q x+b^q$. When $k\subset \dF_q$, then $a^q=a,b^q=b$, so 
$\Frob_q$ is actually a morphism $E\to E$. 

We've looked informally at the reduction of $E_{/\dQ}$ modulo $p$. This can be 
done directly via the Weierstrass equations. The relation between an elliptic 
curve and its Weierstrass equation is analogous to the relation between a 
vector space and its basis. Often, when proving (and computing) facts in 
linear algebra, we want to use bases, but basis-free proofs are often cleaner. 
In algebraic geometry, it is often possible to prove the same theorems about 
elliptic curves without using Weierstrass equations, but this requires more 
algebraic machinery in general. 

If $\phi:E\to E$ is an isogeny, then $e_m(\phi^\vee(x),y) = e_m(x,\phi(y))$ for 
all $x,y\in E[m]$. So $\phi$ is ``self-adjoint'' as an operator on 
$E[m]\simeq (\dZ/m)^2$. It would be nice to have an operator in characteristic 
zero. Define 
\[
  \tate_l E = \varprojlim E[l^n] \simeq \varprojlim (\dZ/l^n)^2 \simeq \dZ_l^2 .
\]
The ring $\dZ_l$ is a complete discrete valuation ring of characteristic zero. 
It is uncountable, and contains $\dZ$ as a dense subring. Elements can be 
written as $\sum_{n\geqslant 0} a_n p^n$, where $a_n\in \{0,\dots,l-1\}$, but 
this isn't very helpful. Isogenies of $E$ act on $\tate_l E$ by linear 
transformations. So we have a representation $\End(E)\to \matrices_2(\dZ_l)$. 
Usually, for $k$ a number field, $\End(E)\simeq \dZ$. Rarely, 
$\End(E)\otimes\dQ\simeq \dQ(\sqrt{-d})$ for some $d\in \dN$. For $k$ of 
characteristic $p$, $\End(E)\otimes \dQ$ will either be a quadratic imaginary 
field or a quaternion algebra. 

\begin{theorem}[Faltings]
Let $k$ be a number field, $E_{/k}$ an elliptic curve. Then 
$\End(E)\otimes \dZ_l\iso \End_{\dZ_l[G_k]}(\tate_l E)$. 
\end{theorem}

This theorem is highly non-trivial, and holds for arbitrary abelian varieties 
over a global field. The Tate module $\tate_l E$ with its Galois action, 
``knows'' $L(E,s)$, which (if we believe BSD) ``knows'' $\rank(E)$. Faltings 
proved that $\tate_l E$ determines $E$ up to isogeny. 

\begin{proposition}\label{prop:isog-invert}
Let $k$ be a field, $E_1,E_2$ elliptic curves over $k$, and $n$ an integer 
invertible in $k$. If $\phi:E_1\to E_2$ is an isogeny and 
$\ker\phi\supset E_1[n]$, then there exists $\psi:E_1\to E_2$ such that 
$\phi=\psi\circ[n]$. 
\end{proposition}
\begin{proof}
This follows directly from \cite[III 4.11]{silverman-2009}. 
\end{proof}

\begin{proposition}\label{prop:end-rank}
Let $E_{/k}$ be an elliptic curve. Then $\End(E)$ is a finitely generatd 
abelian group of rank $\leqslant 4$. 
\end{proposition}
\begin{proof}
Let $R=\End(E)$. We will first show that if $M\subset R$ is a finitely 
generated subgroup, then 
\[
  M^\mathrm{div}=\{\phi\in R:[n]\phi\in M\text{ for some } n\geqslant 1\} 
\]
is also finitely generated. Indeed, we can naturally extend the degree map 
to $\deg:M_\dR=M\otimes \dR\to \dR$. There is a natural embedding 
$M^\mathrm{div}\subset M_\dR$, and $M^\mathrm{div}$ is a discrete subgroup 
since all $\phi\in \End(E)$ have degree $\geqslant 1$,which implies the 
open set $\{\phi\in M_\dR:\deg\phi<1\}$ is disjoint from $M^\mathrm{div}$. 
Any discrete subgroup of $M_\dR$ has rank $\leqslant \dim(M_\dR)$, so we 
even know that $\rank(M^\mathrm{div})\leqslant \rank(M)$. 

Next, we'll prove that $R_l=R\otimes \dZ_l\monic \End(\tate_l E)$. If 
$\phi\in R_l$ is the zero map on $\tate_l E$. Then there exists a finitely 
generated group $M\subset R$ such that $\phi\in M_l=M\otimes \dZ_l$. Since 
$M^\mathrm{div}$ is finitely generated, for each $n$ there exists 
$\phi_n\in M^\mathrm{div}$ such that $\phi_n\equiv \phi\pmod{l^n}$. Since 
$\phi[l^n]=0$, \autoref{prop:isog-invert} yields that 
$\phi_n\equiv 0\pmod{l^n}$. Since $n$ was arbitrary, we see that $\phi=0$. 

Finally, we show that $R$ has $\dZ$-rank $\leqslant 4$. Let 
$\phi_1,\dots,\phi_t$ be a $\dZ_l$-basis for $R_l$ such that 
$\phi_i\in R$. (Such a basis exists because $R$ is dense in $R_l$.) Note that 
$t\leqslant 4$. Then for $M=\langle \phi_1,\dots,\phi_t\rangle$, we have 
$R=M^\mathrm{div}$, whence $\rank_\dZ(R)\leqslant 4$. 
\end{proof}

\begin{proposition}
Let $E$ be an elliptic curve. Then $\End(E)\otimes\dQ$ is either $\dQ$, 
an imaginary quadratic field, or a quaternion algebra. 
\end{proposition}
\begin{proof}
Note that $\End(E)$ has no zero-divisors. Indeed, isogenies have finite 
kernel, so the composite of two isogenies has finite kernel. Thus the only 
way for the composite of two endomorphisms to be zero is for one of them to 
have been $0$ to begin with. 

Now we apply \cite[III 9.3]{silverman-2009} to show that any such ring 
posessing an anti-involution is either $\dZ$, an order in an imaginary 
quadratic field, or an order in a quaternion algebra. The involution we use 
is the \emph{Rosatti involution}, given by $\phi\mapsto \phi^\vee$. 
\end{proof}

As an aside, note that $\dQ(\dmu_{p^\infty})/\dQ$ has Galois group 
$\dZ_p^\times\simeq \dZ/(p-1)\times \dZ_p$. So there is a $\dZ_p$-extension 
$L$ of $\dQ$ (this extension is unique by class field theory). More generally, 
if $k$ is a number field, let $L$ be the composite of all $\dZ_p$-extensions of 
$k$. Write $r=\rank_{\dZ_p}\galois(L/k)$. The famous \emph{Leopoldt conjecture} 
is that $r=r_2+1$ where $r_2$ is the number of complex places of $k$. In 
\cite{brumer-1967}, Brumer proved Leopoldt's conjecture for abelian extensions 
of $\dQ$. At the moment, despite several claimed proofs, the general case is 
wide open. It is not even clear if the conjecture holds for any specific 
non-solvable extensions of $\dQ$. 

This is relevant to \autoref{prop:end-rank} because of the following 
argument. Note that there is a natural map 
$\cO_k^\times \to \cO_{k,p}^\times$, where 
$\cO_{k,p}=\cO_k\otimes \dZ_p=\prod_{\fp\mid p} \cO_{k,\fp}$. Leopoldt's 
conjecture is equivalent to this map being an injection, i.e.~$\dZ$-linearly 
independent elements remaining $\dZ_p$-independent. 

\begin{proposition}
Let $E_{/k}$ be an elliptic curve, $\psi:E\to E$ be an isogeny. Then 
$\det(\psi,\tate_l E) = \deg(\psi)\in \dZ$ and 
$\trace(\psi,\tate_l E) = 1+\deg\psi-\deg(1-\psi)$. 
\end{proposition}
\begin{proof}
Write $\psi_l$ for $\psi$ considered as an endomorphism of $\trace_l E$.. 
We can write 
$\psi_l=\begin{pmatrix} a & b \\ c & d \end{pmatrix}\in \matrices_2(\dZ_l)$ 
with respect to some basis. We'll use $\varprojlim e_{l^n}$ to get a pairing 
$e:\tate_l E\times \tate_l E\to \varprojlim \dmu_{l^n} = \tate_l \Gm$. We now 
compute 
\begin{align*}
  e(v_1,v_2)^{\deg\psi} 
    &= e([\deg\psi]v_1,v_2) \\
    &= e(\psi_l^\vee\psi_l v_1,v_2) \\
    &= e(\psi_l v_1,\psi_l v_2) \\
    &= e(a v_1+c v_2, b v_1+d v_2) \\
    &= e(v_1,v_2)^{a d-b c} \\
    &= e(v_1,v_2)^{\det(\psi_l)} .
\end{align*}
Since the Weil pairing is perfect, this forces $\deg\psi=\det(\psi_l)$. 

In general, we know that for any $2\times 2$ matrix $\theta$, we have 
\begin{equation*}\label{eq:trace-id}
  \trace(\theta)=1+\det(\theta)-\det(1-\theta); 
\end{equation*}
so we're done. 
\end{proof}

Let's apply this result to $\Frob_5$ on $E_{/\dF_5}:y^2=x^3+3 x+1$. We know 
$\deg(\Frob_5)=5$. Consider the characteristic polynomial 
$\det(T-\Frob_5,\tate_l E)$; it has two roots $\alpha,\beta$. We know that 
$\alpha\beta=\deg(\Frob_5)=5$. From our identity \eqref{eq:trace-id} with 
$\theta=\Frob_{5,l}$, we get 
$\alpha+\beta=1+5-\det(1-\Frob_{5,l}) = 6-\# E(\dF_5)$. Consider the following 
table: 
\begin{center}
\begin{tabular}{c|cc}
$x$ & $x^3+3 x+1$ & $\#\sqrt{x^3+3 x+1}$ \\ \hline
0 & 1 & 2 \\
1 & 0 & 1 \\
2 & 0 & 1 \\
3 & 2 & 0 \\
4 & 2 & 0 
\end{tabular}
\end{center}
We conclude that $\# E(\dF_5)=5$, so $\alpha+\beta=1$. In general, 
$\#E(\dF_{5^f}) = (1-\alpha^f)(1-\beta^f)$, so for example 
\begin{align*}
  \# E(\dF_{5^3}) 
    &= (1-\alpha^3)(1-\beta^3) \\
    &= 1-(\alpha^3+\beta^3) + (\alpha\beta)^2 \\
    &= 1-(\alpha+\beta)^3 + 3\alpha\beta(\alpha+\beta) + (2\beta)^3 \\
    &= 1-1^3 + 3\cdot 5\cdot 1 + 5^3 \\
    &= 140 .
\end{align*}
So we see that computing something like $\# E(\dF_q)$ is easy. More 
importantly, $\# E(\dF_q),\# E(\dF_{q^2}),\ldots$ depnds only on two pieces 
of data. This brings us to the Weil Conjectures. 





\subsection{Weil conjectures}

Let $V_{/\dF_q}$ be a smooth proper $d$-dimensional variety. Set 
\[
  Z(V,T) = \exp\left(\sum_{n\geqslant 1} \# V(\dF_{q^n}) \frac{T^n}{n}\right) .
\]
This is just a fancy generating series encoding the numbers $\# V(\dF_{q^n})$. 

\begin{conjecture}[Weil]
\leavevmode
\begin{enumerate}
\item $Z(V,T)\in \dQ(T)$. 
\item $Z\left(V,\displaystyle\frac{1}{q^d T}\right) = \pm q^{d\chi/2} T^\chi Z(V,T)$
\item $Z(V,T)=\prod_{i=0}^{2 d} P_i(T)^{(-1)^{i+1}}$, where $P_i\in \dZ[T]$ and 
the roots of $P_i$ are pure of size $q^{i/2}$. 
\end{enumerate}
\end{conjecture}

Part 1 of the Weil Conjectures tells us that $Z(V,T)$ actually contains only a 
finite amount of information. This was proved by Dwork in [find source]. In 
part 2, $\chi$ is the Euler characteristic of $V$; this was proved by 
Grothendieckin SGA 5. Part 3 was proved by Deligne in [source]. 

The roots of $P_i$ are algebraic numbers. An algebraic number 
$\omega\in \overline\dQ$ is \emph{pure} if the absolute value 
$|\iota(\omega)|$ is the same for all embeddings 
$\iota:\overline\dQ\monic \dC$. Grothendieck proved more than 2; we have 
\[
  Z(V,T) = \prod_{i=0}^{2 d} \det\left(T-\Frob_q,\h_\etale^i(V_{\overline{\dF_q}},\dQ_l)\right)^{(-1)^{i+1}} .
\]
You should think about $\Frob_q$ acting on 
$\tate_l E = \h_\etale^1(E_{\overline{\dF_q}},\dZ_l)$. This is basically 
a rephrasing of the Lefschetz trace formula from algebraic topology. However, 
the algebraic Lefschetz trace formula is enormously difficult. 

Deligne's result settles the Ramanujan conjecture for modular forms. For 
example, define $\tau$ by 
\[
  \Delta=q \prod_{n\geqslant 1} (1-q^n)^{24} = \sum_{n\geqslant 0} \tau(n) q^n .
\]
The Ramanujan conjecture is: $|\tau(p)|\leqslant p^{11/2}$. Even here, 
algebraic geometry is lurking under the surface. 





\subsection{\texorpdfstring{$p$}{p}-adic numbers}

Recall the $p$-adic norm $|\cdot|_p:\dQ\to \dR_{\geqslant 0}$, 
defined by $|p^r \frac m n |_p = p^{-r}$, if $p\nmid m,n$. It is an easy 
exercise to check that this actually is a norm, i.e.~it is multiplicative and 
satisfies $|x+y|\leqslant \max\{|x|,|y|\}$. The completion of $\dQ$ with 
respect to this norm is denoted $\dQ_p$. There is an obvious embedding 
$\dQ\monic \dQ_p$ with dense image. Let 
\[
  \dZ_p=\{x\in \dQ_p:|x|_p\leqslant 1\} .
\]
It turns out that $\dZ_p$ is a complete discrete valuation ring which is 
compact. Thus $\dQ_p$ is locally compact as a topological field. 

\begin{lemma}[Hensel]\label{lem:hensel}
Let $f\in \dZ_p[x]$. Suppose $f(x_0)\equiv 0\pmod p$ for some 
$x_0\in \dF_p$ for which $f'(x_0)\not\equiv 0\pmod p$. Then there exists 
$\widetilde{x_0}\in \dZ_p$ such that $\widetilde{x_0}\equiv x_0\pmod p$ and 
$f(\widetilde{x_0})=0$. 
\end{lemma}
\begin{proof}
Let $X=\spectrum(\dZ_p[x]/f)$. This is a scheme over $S=\spectrum(\dZ_p)$. 
The condition on $f'(x_0)$ is exactly that the fiber $X_{x_0}$ is smooth 
over $S$. It is known that smooth morphisms are formally smooth, so 
$X_{x_0}(\dZ/p^{n+1}) \epic X_{x_0}(\dZ/p^n)$ for all $n$, whence the 
result. 
\end{proof}

\begin{example}[Selmer]
The curve $C_{/\dQ}$ given by $3 x^3+4 y^3+5 z^3=0$ satisfies 
$C(\dA_\dQ)\ne \varnothing$, but $C(\dQ)=\varnothing$. That 
$C(\dR)\ne \varnothing$ is an elementary exercise. We'll show that 
$C(\dQ_p)\ne\varnothing$ or $p\equiv 2\pmod 3$. Let $x=y=1$. Then 
$7+5 z^3=0$ is equivalent to $z^3=-7/5$. Let's solve this modulo $p$ 
for $p\ne 5$. Note that $\dF_p^\times \simeq \dZ/(p-1)$, and 
$3\nmid (p-1)$, which means that raising to the third power is surjective 
as a map $\dF_p^\times\to \dF_p^\times$. The derivative condition in 
\autoref{lem:hensel} applies, so there is a solution in $\dQ_p$. For $p=5$, 
let $x=1,z=0$ and we get $y^3=-3/4$. Repeat the process in $\dF_5^\times$. 
\end{example}

As a homework problem, show that if $p\equiv 1\pmod 3$, then 
$C(\dQ_p)\ne\varnothing$. 

Let $\overline{\dQ_p}$ be an algebraic closure of $\dQ_p$. Then by 
\cite[II 6.6]{neukirch-1999}, the absolute value on $\dQ_p$ has a unique 
extension to one on $\overline{\dQ_p}$. We will write $|\cdot|=|\cdot|_p$ for 
both. We can define 
\begin{align*}
  \cO_{\overline{\dQ_p}} &= \{x\in \overline{\dQ_p}:|x| \leqslant 1 \} \\
  \fm_{\overline{\dQ_p}} &= \{x\in \overline{\dQ_p}:|x|<1\} .
\end{align*}
Then $\cO_{\overline{\dQ_p}}$ is a (non-noetherian) local ring with maximal 
ideal $\fm_{\overline{\dQ_p}}$ and residue field $\overline{\dF_p}$. By the 
uniqueness of the extension of $|\cdot|$ to $\overline{\dQ_p}$, we see that 
$|\sigma(x)|=|x|$ for all $x\in \overline{\dQ_p}$. This allows us to define a 
short exact sequence of Galois groups: 
\[\begin{tikzcd}
  1 \ar[r] 
    & I_p \ar[r] 
    & G_{\dQ_p} \ar[r] 
    & G_{\dF_p} \ar[r] 
    & 1 .
\end{tikzcd}\]
The map $G_{\dQ_p}\to G_{\dF_p}$ is $\sigma(\bar x)=\overline{\sigma(x)}$ for 
$\bar x\in \cO_{\overline{\dQ_p}}/\fm_{\overline{\dQ_p}}$. The group $I_p$, 
called the \emph{inertia group}, can be defined directly by 
\[
  I_p = \{\sigma\in G_{\dQ_p} : \sigma(x)\equiv x\mod\fm_{\overline{\dQ_p}} \text{ for all }x\in \cO_{\overline{\dQ_p}}\} .
\]
Write $\dQ_p^\unram$ for the field $(\overline{\dQ_p})^{I_p}$; it turns out that 
$p$ is prime in $\dZ_p^\unram=\cO_{\dQ_p^\unram}$. For each $l\ne p$, define 
$t_l:I_p \to \dZ_l$ by 
\[
  \sigma(p^{1/l^n}) = \zeta_{l^n}^{t_l(\sigma)\pmod{l^n}} p^{1/l^n} .
\]
Then $t=\prod_l t_l$ induces another canonical short exact sequence 
(this can be derived from \cite[II 7.7]{neukirch-1999}):
\[\begin{tikzcd}
  1 \ar[r] 
    & P \ar[r] 
    & I_p \ar[r, "t"] 
    & \widehat\dZ / \dZ_p \ar[r] 
    & 1 .
\end{tikzcd}\]
The group $P$ is pro-$p$; in fact it is the Sylow $p$-subgroup of $I_p$. We 
don't ``understand'' representations 
$G_\dQ\to \GL_n(\dZ_p)$ largely because 
$G_\dQ\supset G_{\dQ_p}\supset P$, and we don't understand the 
image of $P$ in $\GL_n(\dZ_p)$. The field of \emph{$p$-adic Hodge 
theory} seeks to understand this image, among other things. 

\begin{definition}
Let $E_{/\dQ}$ be an elliptic curve, $p$ a prime. We say that $E$ has 
\emph{good reduction} at $p$ if there exists an abelian scheme 
$\cE$ over $\dZ_{(p)}$ such that $\cE_\dQ\simeq E$. 
\end{definition}

From the theory of N\'eron models (see \cite{bosch-lutkebohmert-raynaud-1990}), 
such an $\cE$ is unique up to isomorphism. 
Moreover, if $p\geqslant 5$, it is equivalent to require that there exist a 
model $y^2=x^3+A x+B$ for $E$ with $A,B\in \dZ_{(p)}$ and 
$p\nmid (4 A^3+26 B^2)$. For a general elliptic curve $E_{/\dQ}$, write 
$\rho_{E,l}$ for the Galois representation $G_\dQ\to \GL_2(\dZ_l)$ coming from 
the $l$-adic Tate module $\tate_l E$. 

\begin{theorem}[N\'eron-Ogg-Shafarevich]\label{thm:neron-ogg}
An elliptic curve $E_{/\dQ}$ has good reduction at $p\ne l$ if and only if 
$\rho_{E,l}(I_p) = 1$. 
\end{theorem}
\begin{proof}
See \cite{serre-tate-1968} for a beautiful proof using the theory of N\'eron 
models. 
\end{proof}

Suppose $E$ has good reduction at some $p\ne l$. Since $\rho_{E,l}(I_p)=1$, the 
representation $\rho_{E,l}|_{G_{\dQ_p}}$ factors 
through $G_{\dF_p} = \widehat\dZ$, which is (canonically) generated by Frobenius 
$\frobenius_p:x\mapsto x^p$. The matrix $\rho_{E,l}(\frobenius_p)$ is 
semisimple, hence conjugate to 
$\begin{pmatrix} \alpha_p \\ & \beta_p \end{pmatrix}$, 
where $\# E(\dF_f) = p^f+1-(\alpha_p^f + \beta_p^f)$ for all $f$. 

If $E$ has bad reduction at $p$, the inertia at $p$ will act nontrivially 
on $\tate_l E$, so $\rho_{E,l}(\frobenius_p)$ is not meaningful here. But we 
still have an action of $\frobenius_p$ on 
$(\tate_l E)^{I_p} = \h^0(I_p,\tate_l E)$. This lets us define the $L$-factors 
of $L(E,s)$ at primes of bad reduction. Namely, 
\begin{align*}
  L_p(E,t) & \det\left(1-\frobenius_p\cdot t, (\tate_l E)^{I_p}\right)^{-1} && (\text{any }l\ne p)\\
  L(E,s) &= \prod_p L_p(E,p^{-s}) .
\end{align*}
If $(\tate_l E)^{I_p}=\tate_l E$, we get 
\[
  \det\left(1-\begin{pmatrix} \alpha_p p^{-s} \\ & \beta_p p^{-s} \end{pmatrix} \right) = \left(1-\frac{\alpha_p}{p^s}\right)\left(1-\frac{\beta_p}{p^s}\right) = 1 + a_p p^{-s} + p^{1-2 s} ,
\]
so this definition of $L(E,s)$ agrees with our earlier definition at the places 
of good reduction. One thing that is not \emph{a priori} clear is whether 
$L_p(E,s)$ depends on the choice of the prime $l$. If $E$ has good reduction at 
$p$, then we can see that $L_p(E,s)$ doesn't depend on $l$, but in general it 
is not obvious. Fortunately, by \cite[3.3.9]{deligne-1980}, this is the case. 
At primes of bad reduction, this is even harder. For elliptic curves (and more 
generally, abelian varieties), this can be done directly using N\'eron models. 

\begin{conjecture}[Birch, Swinnerton-Dyer]
Let $E_{/\dQ}$ be an elliptic curve. Then $L(E,s)$ admits a meromorphic 
continuation to a neighborhood of $s=1$, and 
$\order_{s=1} L(E,s) = \rank(E)$. 
\end{conjecture}

We have essentially proved that the product formula for $L(E,s)$ is analytic 
for $\Re s>3/2$. This is easy when we know there are only finitely many 
primes of bad reduction, and 
\begin{align*}
  |\alpha_p+\beta_p=a_p| &\leqslant 2\sqrt p \\
  \alpha_p \beta_p &= p .
\end{align*}

In our definition of $L_p(E,t)$, we looked at 
$\rho_{E,l}|_{G_{\dQ_p}}:G_{\dQ_p}\to \GL_2(\dZ_l)$ for some prime 
$l$ that is \emph{not} equal to $p$. Also, in the N\'eron-Ogg-Shafarevich 
criterion (\ref{thm:neron-ogg}), we needed $l=p$. What can be said about 
$\rho_p=\rho_{E,p}|_{G_{\dQ_p}}:G_{\dQ_p} \to \GL_2(\dZ_p)$? Even if $E$ 
has good reduction at $p$, this representation can be ramified. 
There are two cases. If $E$ has \emph{ordinary reduction}, then we have 
\[
  \rho_p \sim \begin{pmatrix} \varepsilon \chi & \ast \\ & \psi^{-1} \end{pmatrix} ,
\]
where $\psi:G_{\dQ_p}\to \dZ_p^\times$ is unramified and 
$\varepsilon$ is the $p$-adic cyclotomic character.
If $E$ has good supersingular reduction at $p$, then $\rho_p$ is irreducible. 

Although it is ramified, the representation $\rho_p$ knows quite a lot about 
$E$. For example, the $L$-factor at $p$ can be recovered from $\rho_p$, though 
this is quite tricky and involves Fontaine's semistable period ring 
$\mathbf{B}_\mathrm{st}$ \cite{ochiai-1999}. 




\subsection{Selmer groups}

Let $E_{/\dQ}$ be an elliptic curve. Recall we have a short exact sequence 
\[\begin{tikzcd}
  0 \ar[r] 
    & E[p](\overline\dQ) \ar[r] 
    & E(\overline\dQ) \ar[r] 
    & E(\overline\dQ) \ar[r] 
    & 0 .
\end{tikzcd}\]

Take $G_\dQ$ (resp.~$G_{\dQ_l}$)-invariants. We get a commutative 
diagram:  
\[\begin{tikzcd}
  0 \ar[r] 
    & E(\dQ)/p \ar[r] \ar[d] 
    & \h^1(G_\dQ,E[p]) \ar[r] \ar[d] 
    & \h^1(G_\dQ,E)[p] \ar[r] \ar[d] 
    & 0 \\ 
  0 \ar[r] 
    & \displaystyle\prod_l E(\dQ_l)/p \ar[r] 
    & \displaystyle\prod_l \h^1(G_{\dQ_l},E[p]) \ar[r] 
    & \displaystyle\prod_l \h^1(G_{\dQ_l},E)[p] \ar[r] 
    & 0 .
\end{tikzcd}\]
The \emph{Selmer group} of $E$ is 
\[
  \selmer_p(E) = \ker\left(\h^1(G_{\dQ_p},E[p]) \to \prod_l \h^1(G_{\dQ_l},E)[p]\right) .
\]
It is easy to check that $\selmer_p(E)\supset E(\dQ)/p$. Moreover, 
$\dim_{\dF_p}(E(\dQ)/p) \geqslant \rank(E(\dQ))$ (once we know finite 
generation of $E(\dQ)$). 

\begin{theorem}
Let $E_{/\dQ}$ be an elliptic curve. Assume the Mordell-Weil theorem holds for 
$E$. For $p\geqslant 3$, we have $\dim(E(\dQ)\otimes\dF_p) = \rank(E)+\delta$, 
where 
\[
  \delta = \begin{cases} 0 & E[p](\dQ) = 0 \\ 1 & \text{else} .\end{cases}
\] 
\end{theorem}
\begin{proof}
We can ignore prime-to-$p$ torsion. We know that 
$E[p](\dQ)\simeq (\dZ/p)^\delta$, where $\delta\leqslant 2$. We need to exclude 
$\delta=2$. If this happened, then $G_\dQ$ acts trivially on $E[p]$. But 
$\det(\rho_{E,p})=\varepsilon_p$, and $\varepsilon_p\not\equiv 1\pmod p$ for 
$p\geqslant 3$. Alternatively, $\dmu_p\not\subset \dQ$ for $p\geqslant 3$. 
\end{proof}

What about $p=2$? Is it possible for $E[2](\dQ)=(\dZ/2)^2$? Let $E_{/\dQ}$ be 
the curve $y^2=(x-17)(x-19)(x-21)$. Then 
$E(\dQ)\supset \{(17,0),(19,0),(21,0)\}$, and points on 
$E(\dQ)$ of the form $(x,0)$ are $2$-torsion. More generally, if 
$E_{/\dQ}$ is of the form $y^2=f(x)$ and $f$ has three distinct rational roots, 
then $E[2](\dQ)\simeq (\dZ/2)^2$. 

For $p=2,3,5$, with $E_{/\dQ}$ ordered by height, Bhargava-Shankar proved that 
$\average(\#\selmer_p) = p+1$. If 
$\dim(\selmer_pE)=t$, then $\# \selmer_p(E)=p^t$. For integral 
$t$, we have $p^t\geqslant (p^2-p)(t-1)+p$. Some basic arithmetic gives 
$1+\frac{1}{p(p-1)} \geqslant \rank(E)$. 

Proceeding na\"ively won't get an average $\leqslant 1$. 
We expect $\average(\rank )=1/2$. 
%We need the work of Dokchitser-Dokchitser [Tim and Vladimir], as well as Skinner-Urban's converse to Kolyvagin to get the result. [motivated by Kolyvagin, Kato, Gross-Zagier]





\subsection{State-of-the-art}


Our definition of $L(E,s)$ actually works for \emph{any} Galois representation 
$\rho:G_\dQ\to \GL_n(\dQ_l)$ that is sufficiently nice. That is, we want $\rho$ 
to come in a \emph{compatible family} $\{\rho_l:G_\dQ\to \GL_n(\dQ_l)\}$ that 
have the same characteristic polynomials of Frobenii (and these characteristic 
polynomials lie in $\dQ[T]$) for varying $l$. One puts 
\begin{align*}
  L_p(\rho,t) &= \det\left(1-\rho_l(\frobenius_p)\cdot t,\rho_l^{I_p}\right) && l\ne p \\
  L(\rho,s) &= \prod_p L_p(\rho,s^{-p}) .
\end{align*}
We could make the same definition if $\chi:G_\dQ\to \GL_n(\dC)$ is a continuous 
character. This recovers the classical \emph{Artin $L$-functions}. If 
$n=1$, these are \emph{Dirichlet $L$-functions}, and it is known that if 
$\chi:G_\dQ\to \dC^\times$ is a nontrivial character, then $L(\chi,s)$ has 
analytic continuation to $\dC$ and satisfies $L(\chi,1)\ne 0$. This has as a 
corollary Dirichlet's theorem that for $(a,n)=1$, there are infinitely many 
primes in the sequence $\{a+n k:k\geqslant 1\}$. For general $\rho$, very 
little is known about analytic continuation of $L(\rho,s)$. 

[Serre's book: compatible family, be more careful here\ldots]

For example, if $\rho=\rho_E$ for $E_{/\dQ}$ an elliptic curve, one proves that 
$L(E,s)=L(\rho_E,s)$ has meromorphic continuation by proving that $E$ is 
modular! That is, set $\xi(s)=N^{s/2} (2\pi)^{-s} \Gamma(s) L(E,s)$, where $N$ 
is the conductor of $E$. One proves that $\xi(s)=\pm \xi(2-s)$. But this is 
done by proving that $L(E,s)$ is actually $L(f,s)$ for a cuspidal eigenform 
$f$. 

\begin{theorem}[Wiles, Taylor-Wiles, \ldots]
Let $E_{/\dQ}$ be an elliptic curve. Then for $N$ the conductor of $E$, there 
exists a regular surjection $X_0(N)\epic E$. 
\end{theorem}
\begin{proof}[Strategy of proof]
One considers the associated Galois representation 
$\rho_{E,l}:G_\dQ\to \GL_2(\dZ_l)$ coming from $\tate_l E$. This gives an 
action of $G_\dQ$ on $\adjoint^\circ(\tate_l E)\otimes (\dQ_l/\dZ_l)$. Here 
$M=\adjoint^\circ\subset \mathfrak{gl}_2$ is the subalgebra of trace-zero 
matrices, with action of $\GL(2)$ by conjugation. Consider the kernel of 
\[
  \h^1(G_\dQ,M) \to \bigoplus_p \h^1(G_{\dQ_p},M) / \text{(some subgroup)} .
\]
Wiles reduced proving the modularity of $E$ to a precise computation of 
the kernel (called a generalized Selmer group). 
\end{proof}

The curve $X_0(N)$ is a smooth curve over $\dQ$. A complex-analytic model for 
$X_0(N)$ (minus the cusps) is $\Gamma_0(N)\backslash \fH$, where $\fH$ is 
the upper half plane and 
\[
  \Gamma_0(N)=\left\{\begin{pmatrix} a & b \\ c & d\end{pmatrix}\in \SL_2(\dZ):c\equiv 0\pmod N\right\} .
\]
Given such a surjection $\pi:X_0(N)\epic E$, we can pullback the unique 
holomorphic differential $\omega$ on $E$ to get a holomorphic differential 
$\pi^\ast\omega$ on $X_0(N)$. The differential $\pi^\ast\omega$ will be 
$f(z)\mathrm{d} z$ for a modular form $f$. It is this $f$ which satisfies 
$L(f,s) = L(E,s)$. 

As an aside, let $k\supset \dQ$ be a number field. Then we can define the 
\emph{zeta-function} of $k$ by 
\[
  \zeta_k(s) = \sum_{\fa\subset \cO_k} \frac{1}{\norm(\fa)^s} = \prod_{\fp\in\spectrum(\cO_k)} \left(1-\frac{1}{\norm(\fp)^s}\right)^{-1} .
\]
\begin{theorem}
The function $\zeta_k$ has a simple pole at $s=1$ with residue 
$2^{r_1} (2\pi)^{r_2} \frac{h R}{w\sqrt{D_k}}$, where 
\begin{itemize}
\item $r_1$ is the number of real places of $k$, 
\item $r_2$ is the number of complex places of $k$, 
\item $h=\# \picard(\cO_k)$ is the class number of $k$, 
\item $w=\# \dmu(k)$ is the number of roots of unity in $k$, 
\item $D_k$ is the discriminant of $k$, and 
\item $R$ is the regulator of $k$. 
\end{itemize}
\end{theorem}

Given $k$, it's not hard to compute the residue of $\zeta_k$ at $s=1$ with 
reasonable accuracy. It's easy to compute $r_1,r_2,w$, and $D_k$. So we can 
compute $h R$ pretty easily. But computing $h$ and $R$ individually is quite 
difficult. Quadratic imaginary fields are ``easy,'' because for these fields 
we have $R=1$. 

We are not able to state the (correct) version of the Birch and Swinnerton-Dyer 
conjecture. 

\begin{conjecture}
Let $E_{/\dQ}$ be an elliptic curve. Set $r=\rank(E)$. Then 
$\order_{s=1} L(E,s) = r$, with residue 
$\frac{\Omega \prod_v c_v R \sha}{\# E(\dQ)_\mathrm{tors}^2}$, where 
\begin{itemize}
\item $\Omega$ is the period of $E$ (a complex integral), 
\item $R$ is the regulator of $E$, 
\item $\sha=\#\ker\left(\h^1(\dQ,E)\to \prod_l \h^1(\dQ_l,E)\right)$, and 
\item the $c_v$ are Tamagawa numbers, namely $\#\pi_0(\cE_{\dF_v})$, where 
$\cE$ is the N\'eron model of $E$ at $v$. 
\end{itemize}
\end{conjecture}

We know the following easy fact: let $\phi:E_1\to E_2$ be an isogeny of 
elliptic curves over $\dQ$. Then $L(E_1,s)=L(E_2,s)$. But all other 
of the numbers appearing in BSD except $\# E(\dQ)_\mathrm{tors}$ can be 
different for $E_1$ and $E_2$. The paper [Tate: arithmetic of elliptic 
curves] is a great overview of the arithmetic of elliptic curves. In this 
paper, Tate asked whether $\# \sha<\infty$ and whether $L(E,s)$ is defined at 
$s=1$? The first question is wide open. The second is known, via the 
modularity theorem. 

\begin{theorem}[Gross-Zagier, Kolyvagin, Kato]
Let $E_{/\dQ}$ be an elliptic curve. If $\order_{s=1}L(E,s)\leqslant 1$, 
then the Birch and Swinnerton-Dyer conjecture holds for $E$. 
\end{theorem}

The original proof of this theorem assumed the curve $E$ was modular. Thanks 
to Wiles et.~al., we know this is the case. 

\begin{theorem}[Skinner-Urban]
If $\rank(E)=0$ and $\sha<\infty$ [and some technical hypotheses hold], then 
BSD holds for $E$. 
\end{theorem}

\begin{theorem}[Skinner]
If $\rank(E)=1$ and $\sha<\infty$, then $\order_{s=1} L(E,s)=1$. 
\end{theorem}

\begin{theorem}[Dokchitser-Dokchitser]
If $\sha<\infty$, then $r_\mathrm{an}\equiv r_\mathrm{alg}\pmod 2$. 
\end{theorem}

We expect this congruence. Indeed, we know that 
\[
  L(E,s) = \pm(\text{stuff}>0)L(E,2-s).
\]
From this, assuming BSD, we get the parity conjecture proved by Skinner 
under the assumption that $\sha<\infty$. 

\begin{theorem}[Bhargava-Shankar]
$\average(\rank) \leqslant \average(\dim \selmer_p)\leqslant 1+\frac{1}{p(p-1)}$ 
for $p\in \{2,3,5\}$. 
\end{theorem}

Even if this could be proved for all $p$, we would only know that 
$\average(\rank) \leqslant 1$, but we expect the average to be $1/2$. If we 
could get $\average(\rank)<1$, this would imply that a positive proportion of 
elliptic curves have rank $0$. 

[resort: some of this should be after Selmer groups]

Bhargava et.~al.~construct a family $\fF$ of elliptic curves over $\dQ$, 
that is a positive fraction of the set of all elliptic curves over $\dQ$. All 
the technical hypotheses of Skinner, Skinner-Urban are satisfied on $\fF$. They 
use Dokchitser-Dokchitser as well. Let $p_i$ be the proportion of $E$ in $\fF$ 
with $\dim(\selmer_3)=i$. They prove that $\average(\#\selmer_3)=4$ in $\fF$. 
They also prove that half of the curves in $\fF$ have sign $1$ (resp.~$-1$) in 
their functionnal equations. Consider the sum 
\[
  p_0\cdot 1 + p_1\cdot 3 + \left(\frac 1 2-p_0\right)\cdot 3^2 + \left(\frac 1 2-p_0\right)\cdot 3^3 \leqslant 4.
\]
Note that $p_0\leqslant p_n$ for $n\geqslant 2$. Now the sign $w=1$ if 
and only if $\dim\selmer_p$ is even. We also know that $p_0,p_1\leqslant 1/2$. 
Playing around with the inequality, we get 
\begin{align*}
  p_1 &\geqslant 5/12 \\
  p_0 &\geqslant 1/4 .
\end{align*}
This implies that a positive fraction of all $E$ (not just those in $\fF$) have 
ranks $0$ or $1$. 








